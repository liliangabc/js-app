parcelRequire=function(e,r,n,t){var i="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function u(n,t){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!t&&f)return f(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[n][1][r]||r},p.cache={};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,p,l,l.exports,this)}return r[n].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=i,u.register=function(r,n){e[r]=[function(e,r){r.exports=n},{}]};for(var f=0;f<n.length;f++)u(n[f]);if(n.length){var c=u(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t&&(this[t]=c)}return u}({"LN/f":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e={createStyleSheet:function(e){if(!document.getElementById("gameStyleSheet")){var t=document.createElement("style");t.type="text/css",t.id="gameStyleSheet",t.innerHTML=e,document.head.appendChild(t)}},createCanvas:function(e){e=e||document.body;var t=document.createElement("div"),n=document.createElement("canvas");return t.className="game-wrapper",n.className="game-ui",t.appendChild(n),e.appendChild(t),{wrapper:t,canvas:n}},getPixRatio:function(e){var t=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||1;return(window.devicePixelRatio||1)/t},isFunc:function(e){return"function"==typeof e},getRndInt:function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},imageLoad:function(e){return new Promise(function(t,n){var o=new Image;o.onload=function(){o.onload=null,t(o)},o.onerror=function(e){o.onerror=null,n(new Error("图片加载失败"))},o.src=e})},roundRect:function(e,t,n,o,a,r){o<2*r&&(r=o/2),a<2*r&&(r=a/2),e.beginPath(),e.moveTo(t+r,n),e.arcTo(t+o,n,t+o,n+a,r),e.arcTo(t+o,n+a,t,n+a,r),e.arcTo(t,n+a,t,n,r),e.arcTo(t,n,t+o,n,r),e.closePath()}},t=e;exports.default=t;
},{}],"epB2":[function(require,module,exports) {
"use strict";var t=e(require("../utils"));function e(t){return t&&t.__esModule?t:{default:t}}function o(t){return r(t)||i(t)||n()}function n(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function i(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function r(t){if(Array.isArray(t)){for(var e=0,o=new Array(t.length);e<t.length;e++)o[e]=t[e];return o}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function c(t,e,o){return e&&s(t.prototype,e),o&&s(t,o),t}var h={2:{color:"#333",bgcolor:"#eee4da"},4:{color:"#333",bgcolor:"#ece0ca"},8:{color:"#f7f7f5",bgcolor:"#f2b179"},16:{color:"#f7f7f5",bgcolor:"#f59563"},32:{color:"#f7f7f5",bgcolor:"#f57c5f"},64:{color:"#f7f7f5",bgcolor:"#ff5734"},128:{color:"#f7f7f5",bgcolor:"#f4cc6d"},256:{color:"#f7f7f5",bgcolor:"#d65211"},512:{color:"#f7f7f5",bgcolor:"#e29441"},1024:{color:"#f7f7f5",bgcolor:"#9e790a"},2048:{color:"#fefdf9",bgcolor:"#e0ba01"}},u=function(){function e(o){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a(this,e),this.rows=this.cols=4,this.callbacks=n,this.canvas=t.default.createCanvas(o).canvas,this.context=this.canvas.getContext("2d"),this.pixRatio=t.default.getPixRatio(this.context),this.blockSpace=12*this.pixRatio,this.addListener()}return c(e,[{key:"initUI",value:function(){this.isEnd=!1,this.score=0,this.updateSize(),this.blocks=this.initBlocks(),this.drawUI()}},{key:"updateSize",value:function(){var t=this.canvas.offsetWidth;this.width=this.canvas.width=this.canvas.height=t*this.pixRatio,this.blockSize=(this.width-(this.rows+1)*this.blockSpace)/this.rows}},{key:"colToX",value:function(t){return(this.blockSize+this.blockSpace)*t+this.blockSpace}},{key:"rowToY",value:function(t){return(this.blockSize+this.blockSpace)*t+this.blockSpace}},{key:"getColData",value:function(t){var e=this.colToX(t);return this.blocks.filter(function(t){return t.x===e})}},{key:"getRowData",value:function(t){var e=this.rowToY(t);return this.blocks.filter(function(t){return t.y===e})}},{key:"drawBlock",value:function(e){var o=e.x,n=e.y,i=e.num,r=this.context,a=this.blockSize,s=this.pixRatio;if(t.default.roundRect(r,o,n,a,a,6*s),r.fill(),i){var c=a/((i+"").length>2?3:2);r.save(),r.fillStyle=h[i].color,r.font="bold ".concat(c,"px serif"),r.textBaseline="hanging";var u=o+(a-r.measureText(i).width)/2,l=n+(a-c)/2+6;r.fillText(i,u,l),r.restore()}}},{key:"drawGrids",value:function(){var t=this.rows,e=this.cols,o=this.context;o.save(),o.fillStyle="#eee4da",o.globalAlpha=.35;for(var n=0;n<t;n++)for(var i=0;i<e;i++)this.drawBlock({x:this.colToX(i),y:this.rowToY(n)});o.restore()}},{key:"initBlocks",value:function(){for(var t=[],e=this.rows,o=this.cols,n=0;n<e;n++)for(var i=0;i<o;i++)t.push({x:this.colToX(i),y:this.rowToY(n)});return t.sort(function(){return Math.random()-.5}),t.slice(0,2).forEach(function(t){return t.num=2}),t}},{key:"rndBlock",value:function(){var t=this.blocks.filter(function(t){return!t.num});t.sort(function(){return Math.random()-.5}),t.length&&(t[0].num=2)}},{key:"drawBlocks",value:function(){var t=this;this.blocks.forEach(function(e){e.num&&(t.context.save(),t.context.fillStyle=h[e.num].bgcolor,t.drawBlock(e),t.context.restore())})}},{key:"drawUI",value:function(){this.context.clearRect(0,0,this.width,this.width),this.drawGrids(),this.drawBlocks()}},{key:"addListener",value:function(){document.addEventListener("keyup",this.onDocKeyup.bind(this)),this.canvas.addEventListener("touchstart",this.onTouchstart.bind(this)),this.canvas.addEventListener("touchmove",this.onTouchmove.bind(this)),this.canvas.addEventListener("touchend",this.onTouchend.bind(this))}},{key:"eachData",value:function(e){for(var n=this.callbacks.onScoreUpdate,i=e.map(function(t){return t.num}).filter(function(t){return t}),r=o(i),a=0,s=r.length;a<s;a++){var c=r[a];if(r[a+1]===c){i[a]=2*c,i[a+1]=0,this.score+=2*c,t.default.isFunc(n)&&n(this.score);break}}i=i.filter(function(t){return t}),e.forEach(function(t,e){return t.num=i[e]})}},{key:"moveUp",value:function(){for(var t=0;t<this.cols;t++){var e=this.getColData(t).sort(function(t,e){return t.y-e.y});this.eachData(e)}}},{key:"moveRight",value:function(){for(var t=0;t<this.rows;t++){var e=this.getRowData(t).sort(function(t,e){return e.x-t.x});this.eachData(e)}}},{key:"moveDown",value:function(){for(var t=0;t<this.cols;t++){var e=this.getColData(t).sort(function(t,e){return e.y-t.y});this.eachData(e)}}},{key:"moveLeft",value:function(){for(var t=0;t<this.rows;t++){var e=this.getRowData(t).sort(function(t,e){return t.x-e.x});this.eachData(e)}}},{key:"onDocKeyup",value:function(t){if(!this.isEnd){var e=t.keyCode,o=[87,38],n=[68,39],i=[83,40],r=[65,37];-1!==o.indexOf(e)?this.moveUp():-1!==n.indexOf(e)?this.moveRight():-1!==i.indexOf(e)?this.moveDown():-1!==r.indexOf(e)&&this.moveLeft(),-1!==o.concat(n,i,r).indexOf(e)&&(this.rndBlock(),this.drawUI(),this.checkDone())}}},{key:"onTouchstart",value:function(t){t.preventDefault();var e=t.targetTouches[0];this.startX=e.pageX,this.startY=e.pageY}},{key:"onTouchmove",value:function(t){t.preventDefault();var e=t.targetTouches[0];this.endX=e.pageX,this.endY=e.pageY}},{key:"onTouchend",value:function(){if(this.endX&&!this.isEnd){var t=Math.abs(this.endX-this.startX)/this.pixRatio,e=Math.abs(this.endY-this.startY)/this.pixRatio;(t>6||e>6)&&(t>e?this[this.endX>this.startX?"moveRight":"moveLeft"]():this[this.endY>this.startY?"moveDown":"moveUp"](),this.rndBlock(),this.drawUI(),this.checkDone()),this.startX=this.startY=this.endX=this.endY=0}}},{key:"checkDone",value:function(){for(var e=this,o=this.callbacks,n=o.onWinning,i=o.onGameover,r=0,a=this.blocks.length;r<a;r++){var s=this.blocks[r];if(2048===s.num)return setTimeout(function(){return t.default.isFunc(n)&&n(e.score)},100),this.isEnd=!0,!0;if(!s.num)return!1}if(this.checkCells("rows")&&this.checkCells("cols"))return setTimeout(function(){return t.default.isFunc(i)&&i(e.score)},100),!0}},{key:"checkCells",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"rows",e=0;e<this[t];e++)for(var o=("rows"===t?this.getRowData(e).sort(function(t,e){return e.x-t.x}):this.getColData(e).sort(function(t,e){return e.y-t.y})).map(function(t){return t.num}),n=0;n<o.length;n++){if(o[n]===o[n+1])return!1}return!0}}]),e}(),l=document.getElementById("currentScore"),f=document.getElementById("bestScore");f.textContent=localStorage.getItem("score_for_2048")||0;var v=function(t){var e=localStorage.getItem("score_for_2048")||0;return Math.max(t,e)},d=function(t){var e=v(t);return localStorage.setItem("score_for_2048",e),e},k=new u(document.getElementById("gameContainer"),{onWinning:function(t){confirm("恭喜，你挑战成功了！ 要继续挑战吗？")&&(f.textContent=d(t),l.textContent=0,k.initUI())},onGameover:function(t){confirm("不好意思，你挂了！ 要重新挑战吗？")&&(f.textContent=d(t),l.textContent=0,k.initUI())},onScoreUpdate:function(t){l.textContent=t}});k.initUI();
},{"../utils":"LN/f"}]},{},["epB2"], null)