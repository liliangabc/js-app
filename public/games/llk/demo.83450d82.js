parcelRequire=function(e,r,n,t){var i="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function u(n,t){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!t&&f)return f(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[n][1][r]||r},p.cache={};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,p,l,l.exports,this)}return r[n].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=i,u.register=function(r,n){e[r]=[function(e,r){r.exports=n},{}]};for(var f=0;f<n.length;f++)u(n[f]);if(n.length){var c=u(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t&&(this[t]=c)}return u}({"LN/f":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e={createStyleSheet:function(e){if(!document.getElementById("gameStyleSheet")){var t=document.createElement("style");t.type="text/css",t.id="gameStyleSheet",t.innerHTML=e,document.head.appendChild(t)}},createCanvas:function(e){e=e||document.body;var t=document.createElement("div"),n=document.createElement("canvas");return t.className="game-wrapper",n.className="game-ui",t.appendChild(n),e.appendChild(t),{wrapper:t,canvas:n}},getPixRatio:function(e){var t=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||1;return(window.devicePixelRatio||1)/t},isFunc:function(e){return"function"==typeof e},getRndInt:function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},imageLoad:function(e){return new Promise(function(t,n){var o=new Image;o.onload=function(){o.onload=null,t(o)},o.onerror=function(e){o.onerror=null,n(new Error("图片加载失败"))},o.src=e})},roundRect:function(e,t,n,o,a,r){o<2*r&&(r=o/2),a<2*r&&(r=a/2),e.beginPath(),e.moveTo(t+r,n),e.arcTo(t+o,n,t+o,n+a,r),e.arcTo(t+o,n+a,t,n+a,r),e.arcTo(t,n+a,t,n,r),e.arcTo(t,n,t+o,n,r),e.closePath()}},t=e;exports.default=t;
},{}],"Focm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=e(require("../utils"));function e(t){return t&&t.__esModule?t:{default:t}}function r(t){return i(t)||n(t)||o()}function o(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function n(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function i(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function l(t,e,r){return e&&c(t.prototype,e),r&&c(t,r),t}var a=function(){function e(r){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s(this,e),this.callbacks=o;var n=r&&"string"==typeof r?document.querySelector(r):r;this.canvas=t.default.createCanvas(n).canvas,this.context=this.canvas.getContext("2d"),this.pixRatio=t.default.getPixRatio(this.context),this.canvas.addEventListener("click",this.onClick.bind(this))}return l(e,[{key:"initUI",value:function(e){var r=this,o=e.rows,n=e.cols,i=e.imgOptions,s=void 0===i?{}:i;if((o=o||n)*n/(s.rows*s.cols)%2)throw new Error("行和列的积除以雪碧图的行和列的积必须是2的倍数.");this.rows=o+2,this.cols=n+2,this.imgOptions=s,this.blockSpace=3*this.pixRatio,this.selBlock=null,this.joinPoints=[],this.updateSize(),t.default.imageLoad(s.src).then(function(t){r.img=t,r.blocks=r.genBlocks(),r.drawUI()})}},{key:"updateSize",value:function(){var t=this.pixRatio,e=this.rows,r=this.cols,o=this.blockSpace,n=this.canvas.offsetWidth;this.width=this.canvas.width=n*t,this.blockSize=(this.width-(r-1)*o)/(r-1),this.height=this.canvas.height=(this.blockSize+o)*(e-1)}},{key:"onClick",value:function(t){var e=this,o=this.getCurBlock(t);if(o&&this.selBlock!==o){if(this.selBlock&&this.isSameBlock(this.selBlock,o)){var n=this.findWay(this.selBlock,o);if(n)return this.drawArc(o),this.drawJoinLines(r(n).concat([o])),this.selBlock.num=o.num=0,this.selBlock=null,setTimeout(function(){e.drawUI(),e.doneCheck()},300)}this.selBlock=o,this.drawUI()}}},{key:"isSameBlock",value:function(t,e){return t.dx===e.dx&&t.dy===e.dy}},{key:"getCenter",value:function(t){return[t.x+t.w/2,t.y+t.h/2]}},{key:"findWay",value:function(t,e){return this.lineDirect(t,e)||this.oneCorner(t,e)||this.twoCorner(t,e)}},{key:"lineDirect",value:function(t,e){var r=[];return(t.row===e.row||t.col===e.col)&&(t.col===e.col?(r=this.blocks.filter(function(e){return e&&e.col===t.col}),r=t.row>e.row?r.filter(function(r){return r.row<t.row&&r.row>e.row}):r.filter(function(r){return r.row>t.row&&r.row<e.row})):t.row===e.row&&(r=this.blocks.filter(function(e){return e&&e.row===t.row}),r=t.col>e.col?r.filter(function(r){return r.col<t.col&&r.col>e.col}):r.filter(function(r){return r.col>t.col&&r.col<e.col})),!!r.every(function(t){return!t.num})&&[])}},{key:"oneCorner",value:function(t,e){var r=this.blocks.find(function(r){return r&&r.row===t.row&&r.col===e.col});return!r.num&&this.lineDirect(t,r)&&this.lineDirect(r,e)?[r]:!((r=this.blocks.find(function(r){return r&&r.row===e.row&&r.col===t.col})).num||!this.lineDirect(t,r)||!this.lineDirect(r,e))&&[r]}},{key:"twoCorner",value:function(t,e){for(var o=this.blocks.filter(function(e){return e&&e!==t&&e.row===t.row}),n=this.blocks.filter(function(e){return e&&e!==t&&e.col===t.col}),i=n.filter(function(e){return e.row<t.row}),s=o.filter(function(e){return e.col>t.col}),c=n.filter(function(e){return e.row>t.row}),l=o.filter(function(e){return e.col<t.col}),a=i.length-1;a>=0;a--){var u=i[a];if(u.num)break;var h=this.oneCorner(u,e);if(h)return[u].concat(r(h))}for(var f=0;f<s.length;f++){var w=s[f];if(w.num)break;var v=this.oneCorner(w,e);if(v)return[w].concat(r(v))}for(var d=0;d<c.length;d++){var k=c[d];if(k.num)break;var y=this.oneCorner(k,e);if(y)return[k].concat(r(y))}for(var p=l.length-1;p>=0;p--){var b=l[p];if(b.num)break;var g=this.oneCorner(b,e);if(g)return[b].concat(r(g))}}},{key:"doneCheck",value:function(){var t=this.callbacks.onDone,e=void 0===t?function(){}:t;return this.blocks.every(function(t){return!(t&&t.num)})&&setTimeout(e,100)}},{key:"createSprites",value:function(){for(var t=[],e=[],r=this.img,o=this.imgOptions,n=r.width/o.cols,i=0;i<o.rows;i++)for(var s=0;s<o.cols;s++)t.push({dx:n*s,dy:n*i,dw:n});for(var c=(this.rows-2)*(this.cols-2)/t.length,l=0;l<c;l++)e.push.apply(e,t);return e.sort(function(){return Math.random()-.5}),e}},{key:"genBlocks",value:function(){for(var t=[],e=this.createSprites(),r=0,o=this.rows,n=this.cols,i=this.blockSize,s=this.blockSpace,c=0;c<o;c++)for(var l=0;l<n;l++){var a=(i+s)*(l-1)+s+i/2,u=(i+s)*(c-1)+s+i/2;if(0===l&&0===c||l===n-1&&0===c||0===l&&c===o-1||l===n-1&&c===o-1)t.push(null);else if(0===l)t.push({row:c,col:l,num:0,x:0,y:u,w:i/2,h:i});else if(l===n-1)t.push({row:c,col:l,num:0,x:a,y:u,w:i/2,h:i});else if(0===c)t.push({row:c,col:l,num:0,x:a,y:0,w:i,h:i/2});else if(c===o-1)t.push({row:c,col:l,num:0,x:a,y:u,w:i,h:i/2});else{var h=e[r],f=h.dx,w=h.dy,v=h.dw;t.push({row:c,col:l,dx:f,dy:w,dw:v,num:1,x:a,y:u,w:i,h:i}),r++}}return t}},{key:"rinse",value:function(){this.selBlock=null;var t=[],e=0;this.blocks.forEach(function(e){return e&&e.dw&&e.num&&t.push({dx:e.dx,dy:e.dy})}),t.sort(function(){return Math.random()-.5});for(var r=0;r<this.blocks.length;r++){var o=this.blocks[r];o&&o.dw&&o.num&&(o.dx=t[e].dx,o.dy=t[e].dy,e++)}this.drawUI()}},{key:"drawUI",value:function(){var t=this;this.context.clearRect(0,0,this.width,this.height),this.blocks.forEach(function(e){e&&e.num&&t.context.drawImage(t.img,e.dx,e.dy,e.dw,e.dw,e.x,e.y,e.w,e.h)}),this.selBlock&&this.drawArc(this.selBlock)}},{key:"drawArc",value:function(t){var e,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.6;this.context.save(),this.context.fillStyle="rgba(0, 0, 0, ".concat(o,")"),this.context.beginPath(),(e=this.context).arc.apply(e,r(this.getCenter(t)).concat([t.w/2,0,2*Math.PI])),this.context.closePath(),this.context.fill(),this.context.restore()}},{key:"drawJoinLines",value:function(t){var e=this,o=this.context,n=this.selBlock,i=this.pixRatio,s=t[0];(1!==t.length||1!==Math.abs(n.row-s.row)&&1!==Math.abs(n.col-s.col))&&(o.save(),o.strokeStyle="#555",o.lineWidth=i,o.beginPath(),o.moveTo.apply(o,r(this.getCenter(n))),t.forEach(function(t){var o;return(o=e.context).lineTo.apply(o,r(e.getCenter(t)))}),o.stroke(),o.restore())}},{key:"getCurBlock",value:function(t){var e=(t.offsetX||t.pageX)*this.pixRatio,r=(t.offsetY||t.pageY)*this.pixRatio;return this.blocks.find(function(t){if(t){var o=t.x+t.w/2,n=t.y+t.h/2;return t.num&&(e-o)*(e-o)+(r-n)*(r-n)<t.w*t.h/4}})}}]),e}(),u=a;exports.default=u;
},{"../utils":"LN/f"}],"krU1":[function(require,module,exports) {
module.exports="/games/llk/sprite.63526224.png";
},{}],"lgAh":[function(require,module,exports) {
"use strict";var e=t(require("./index")),n=t(require("./img/sprite.png"));function t(e){return e&&e.__esModule?e:{default:e}}var i={cols:8,imgOptions:{src:n.default,rows:4,cols:4}},r=new e.default("#gameDemo",{onDone:function(){confirm("恭喜，你完成了！要重新开始吗？")&&r.initUI(i)}});r.initUI(i);var c=document.getElementById("btnRestart"),o=document.getElementById("btnRinse");c.addEventListener("click",function(e){r.initUI(i)}),o.addEventListener("click",function(e){r.rinse()});
},{"./index":"Focm","./img/sprite.png":"krU1"}]},{},["lgAh"], null)