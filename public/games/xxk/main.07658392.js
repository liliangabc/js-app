(function () {function a(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function c(t,r){for(var o=0;o<r.length;o++){var e=r[o];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function d(t,r,o){return r&&c(t.prototype,r),o&&c(t,o),t}var b={createStyleSheet:function(e){if(!document.getElementById("gameStyleSheet")){var t=document.createElement("style");t.type="text/css",t.id="gameStyleSheet",t.innerHTML=e,document.head.appendChild(t)}},createCanvas:function(e){e=e||document.body;var t=document.createElement("div"),n=document.createElement("canvas");return t.className="game-wrapper",n.className="game-ui",t.appendChild(n),e.appendChild(t),n},getPixRatio:function(e){var t=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||1;return(window.devicePixelRatio||1)/t},isFunc:function(e){return"function"==typeof e},getRndInt:function(e,t){return Math.floor(Math.random()*(t-e+1)+e)}};b.createStyleSheet("* {\r\n  padding: 0;\r\n  margin: 0;\r\n  box-sizing: border-box;\r\n}\r\n\r\nbody {\r\n  background-color: #fbe9e7;\r\n}\r\n\r\n.game-wrapper {\r\n  max-width: 480px;\r\n  margin: auto;\r\n  padding: 0 6px 6px;\r\n}\r\n\r\n.game-wrapper canvas.game-ui {\r\n  display: block;\r\n  width: 100%;\r\n  border-radius: 4px;\r\n  background-color: #fff;\r\n  cursor: pointer;\r\n  -webkit-tap-highlight-color: transparent;\r\n  box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);\r\n}");var f=function(){function t(r){var o=r.row,e=r.col,i=r.color;a(this,t),this.row=o,this.col=e,this.color=i}return d(t,[{key:"draw",value:function(t){var r=t.context,o=t.size,e=t.space;r.save(),r.fillStyle=this.color,r.fillRect(this.col*o+e,this.row*o+e,o-e,o-e),r.restore()}}]),t}(),e=function(){function t(r){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a(this,t),this.callbacks=o,this.canvas=b.createCanvas(r),this.context=this.canvas.getContext("2d"),this.pixRatio=b.getPixRatio(this.context),this.addListener()}return d(t,[{key:"initUI",value:function(t){var r=t.rows,o=t.cols,e=t.colors,i=void 0===e?[]:e;if(i.length<3)throw new Error("\u8BF7\u81F3\u5C11\u63D0\u4F9B3\u79CD\u989C\u8272.");if(this.rows=r||o,this.cols=o,this.rows*this.cols%2)throw new Error("\u884C\u548C\u5217\u7684\u79EF\u5FC5\u987B\u662F2\u7684\u500D\u6570.");this.colors=i,this.blockSize=0,this.blockSpace=2*this.pixRatio,this.removedColor="#fff",this.updateSize(),this.blocks=this.genBlocks(),this.drawBlocks()}},{key:"updateSize",value:function(){var t,r=this.canvas.offsetWidth;this.canvas.width=t=this.pixRatio*r,this.blockSize=(t-this.blockSpace)/this.cols,this.canvas.height=this.rows*this.blockSize+this.blockSpace}},{key:"genBlocks",value:function(){for(var t=this.rows*this.cols,r=this.colors.length,o=[],e=[],i=0,s=0;s<t/2;s++)o.push(this.colors[b.getRndInt(0,r-1)]);o=o.concat(o).sort(function(){return Math.random()-.5});for(var n=0;n<this.rows;n++)for(var a=0;a<this.cols;a++)e.push(new f({row:n,col:a,color:o[i]})),i++;return e}},{key:"drawBlocks",value:function(){var t=this.canvas,r=t.width,o=t.height,e=this.context,i=this.blockSize,s=this.blockSpace;this.context.clearRect(0,0,+r,+o),this.blocks.forEach(function(t){return t.draw({context:e,size:i,space:s})})}},{key:"getCurBlock",value:function(t){for(var r=(t.offsetX||t.pageX)*this.pixRatio,o=(t.offsetY||t.pageY)*this.pixRatio,e=Math.floor(r/this.blockSize),i=Math.floor(o/this.blockSize),s=0,n=this.blocks.length;s<n;s++){var a=this.blocks[s];if(a.row===i&&a.col===e)return a}}},{key:"getTRBLBlocks",value:function(t){var r=this.blocks.indexOf(t),o=this.blocks[r-this.rows],e=this.blocks[r+1],i=this.blocks[r+this.rows],s=this.blocks[r-1],n=[o,e,i,s];return r%this.cols==0?n=[o,e,i]:(r+1)%this.cols==0&&(n=[o,i,s]),n.filter(function(t){return t})}},{key:"getIdentColorBlocks",value:function(t){for(var r=this,o=[],e=[t],i=function(){var t=e.pop();o.push(t),r.getTRBLBlocks(t).forEach(function(r){r.color===t.color&&-1===o.indexOf(r)&&e.push(r)})};e.length;)i();return o}},{key:"addListener",value:function(){this.canvas.addEventListener("click",this.onClick.bind(this))}},{key:"onClick",value:function(t){var r=this,o=this.getCurBlock(t);if(o&&o.color!==this.removedColor){var e=this.getIdentColorBlocks(o);e.length<2||(e.forEach(function(t){return t.color=r.removedColor}),this.drawBlocks())}}}]),t}(),g=new e;g.initUI({cols:10,colors:["#22a6ea","#f44e4e","#b3cc25","#f1a30c","#b854e6"]});})();