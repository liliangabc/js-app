parcelRequire=function(e,r,n,t){var i="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function u(n,t){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!t&&f)return f(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[n][1][r]||r},p.cache={};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,p,l,l.exports,this)}return r[n].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=i,u.register=function(r,n){e[r]=[function(e,r){r.exports=n},{}]};for(var f=0;f<n.length;f++)u(n[f]);if(n.length){var c=u(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t&&(this[t]=c)}return u}({"7MKc":[function(require,module,exports) {

},{}],"LN/f":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e={createStyleSheet:function(e){if(!document.getElementById("gameStyleSheet")){var t=document.createElement("style");t.type="text/css",t.id="gameStyleSheet",t.innerHTML=e,document.head.appendChild(t)}},createCanvas:function(e){e=e||document.body;var t=document.createElement("div"),a=document.createElement("canvas");return t.className="game-wrapper",a.className="game-ui",t.appendChild(a),e.appendChild(t),{wrapper:t,canvas:a}},getPixRatio:function(e){var t=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||1;return(window.devicePixelRatio||1)/t},isFunc:function(e){return"function"==typeof e},getRndInt:function(e,t){return Math.floor(Math.random()*(t-e+1)+e)}},t=e;exports.default=t;
},{}],"epB2":[function(require,module,exports) {
"use strict";var t=n(require("fs")),o=n(require("../utils"));function n(t){return t&&t.__esModule?t:{default:t}}function r(t,o){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}function e(t,o){for(var n=0;n<o.length;n++){var r=o[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}o.default.createStyleSheet("* {\r\n  padding: 0;\r\n  margin: 0;\r\n  box-sizing: border-box;\r\n}\r\n\r\nbody {\r\n  background-color: #fbe9e7;\r\n}\r\n\r\n.game-wrapper {\r\n  max-width: 480px;\r\n  margin: auto;\r\n  position: relative;\r\n}\r\n\r\n.game-wrapper canvas.game-ui {\r\n  display: block;\r\n  width: 100%;\r\n  padding: 3px;\r\n  border-radius: 4px;\r\n  background-color: #fff;\r\n  cursor: pointer;\r\n  -webkit-tap-highlight-color: transparent;\r\n  box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);\r\n}\r\n\r\n.game-wrapper .scores {\r\n  position: absolute;\r\n  text-align: center;\r\n  color: #212121;\r\n}");var c=function(){function t(o){var n=o.row,e=o.col,i=o.color;r(this,t),this.row=n,this.col=e,this.color=i}return i(t,[{key:"draw",value:function(t){var o=t.context,n=t.size,r=t.space;o.save(),o.fillStyle=this.color,o.fillRect(this.col*n+r,this.row*n+r,n-r,n-r),o.restore()}}]),t}(),s=function(){function t(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,t),this.callbacks=e;var i=o.default.createCanvas(n),c=i.wrapper,s=i.canvas;this.wrapper=c,this.canvas=s,this.context=this.canvas.getContext("2d"),this.pixRatio=o.default.getPixRatio(this.context),this.addListener()}return i(t,[{key:"initUI",value:function(t){var o=t.rows,n=t.cols,r=t.colors,e=void 0===r?[]:r;if(e.length<3)throw new Error("请至少提供3种颜色.");if(this.rows=o||n,this.cols=n,this.rows*this.cols%2)throw new Error("行和列的积必须是2的倍数.");this.colors=e,this.score=0,this.blockSize=0,this.blockSpace=2*this.pixRatio,this.updateSize(),this.blocks=this.genBlocks(),this.drawBlocks()}},{key:"updateSize",value:function(){var t,o=this.canvas.offsetWidth;this.canvas.width=t=this.pixRatio*o,this.blockSize=(t-this.blockSpace)/this.cols,this.canvas.height=this.rows*this.blockSize+this.blockSpace}},{key:"genBlocks",value:function(){for(var t=this.rows*this.cols,n=this.colors.length,r=[],e=[],i=0,s=0;s<t/2;s++)r.push(this.colors[o.default.getRndInt(0,n-1)]);r=r.concat(r).sort(function(){return Math.random()-.5});for(var l=0;l<this.rows;l++)for(var a=0;a<this.cols;a++)e.push(new c({row:l,col:a,color:r[i]})),i++;return e}},{key:"drawBlocks",value:function(){var t=this.canvas,o=t.width,n=t.height,r=this.context,e=this.blockSize,i=this.blockSpace;this.context.clearRect(0,0,+o,+n),this.blocks.forEach(function(t){return t&&t.draw({context:r,size:e,space:i})})}},{key:"getCurBlock",value:function(t){for(var o=(t.offsetX||t.pageX)*this.pixRatio,n=(t.offsetY||t.pageY)*this.pixRatio,r=Math.floor(o/this.blockSize),e=Math.floor(n/this.blockSize),i=0,c=this.blocks.length;i<c;i++){var s=this.blocks[i];if(s&&s.row===e&&s.col===r)return s}}},{key:"getTRBLBlocks",value:function(t){var o=this.blocks.indexOf(t),n=t.row,r=t.col,e=this.blocks.find(function(t){return t&&t.col===r&&t.row===n-1}),i=this.blocks.find(function(t){return t&&t.row===n&&t.col===r+1}),c=this.blocks.find(function(t){return t&&t.col===r&&t.row===n+1}),s=this.blocks.find(function(t){return t&&t.row===n&&t.col===r-1}),l=[e,i,c,s];return o%this.cols==0?l=[e,i,c]:(o+1)%this.cols==0&&(l=[e,c,s]),l.filter(function(t){return t})}},{key:"getIdentColorBlocks",value:function(t){for(var o=this,n=[],r=[t],e=function(){var t=r.pop();-1===n.indexOf(t)&&n.push(t),o.getTRBLBlocks(t).forEach(function(o){o.color===t.color&&-1===n.indexOf(o)&&r.push(o)})};r.length;)e();return n}},{key:"removeBlocks",value:function(t){var o=this;t.forEach(function(t){o.blocks.splice(o.blocks.indexOf(t),1,null)})}},{key:"drawScores",value:function(t){var o=this,n=window.getComputedStyle(this.canvas,null),r=parseInt(n.paddingLeft),e=parseInt(n.paddingTop),i=document.createElement("div");return i.innerHTML=t.map(function(n){var i=n.row*o.blockSize/o.pixRatio+e+"px",c=n.col*o.blockSize/o.pixRatio+r+"px",s=o.blockSize/o.pixRatio+"px";return'<span class="scores" style="top:'.concat(i,";left:").concat(c,";width:").concat(s,";height:").concat(s,";line-height:").concat(s,'">+').concat(t.length,"</span>")}).join(""),this.wrapper.appendChild(i),new Promise(function(t){setTimeout(function(){o.wrapper.removeChild(i),t()},300)})}},{key:"getEmptyCount",value:function(t){return this.rows-t.row-this.blocks.filter(function(o){return o&&o.col===t.col&&o.row>t.row}).length-1}},{key:"getBlocksByCol",value:function(t){return this.blocks.filter(function(o){return o&&o.col===t})}},{key:"dropBlocks",value:function(t){var o=this,n=[];t.forEach(function(t){return-1===n.indexOf(t.col)&&n.push(t.col)}),n.forEach(function(t){var n=[],r=o.getBlocksByCol(t);r.forEach(function(t){return n.push(o.getEmptyCount(t))}),r.forEach(function(t,o){return t.row+=n[o]})})}},{key:"isEmptyCol",value:function(t){return!this.blocks.filter(function(o){return o&&o.col===t}).length}},{key:"getEmptyCols",value:function(){for(var t=[],o=0;o<this.cols-1;o++)this.isEmptyCol(o)&&t.push(o);return t}},{key:"moveCols",value:function(){var t=this.getEmptyCols();this.blocks.forEach(function(o){return o&&(o.col-=t.filter(function(t){return t<o.col}).length)})}},{key:"doneCheck",value:function(){for(var t=this.blocks.filter(function(t){return t}),o=0,n=t.length;o<n;o++){var r=t[o];if(this.getIdentColorBlocks(r).length>1)return!1}return!0}},{key:"addListener",value:function(){this.canvas.addEventListener("click",this.onClick.bind(this))}},{key:"onClick",value:function(t){var n=this,r=this.getCurBlock(t);if(r){var e=this.getIdentColorBlocks(r),i=e.length;if(!(i<2)){var c=this.callbacks.onDone;this.score+=i*i,this.removeBlocks(e),this.drawBlocks(),this.drawScores(e).then(function(){n.dropBlocks(e),n.moveCols(),n.drawBlocks(),n.doneCheck()&&setTimeout(function(){return o.default.isFunc(c)&&c(n.score)},100)})}}}}]),t}(),l={cols:10,colors:["#22a6ea","#f44e4e","#b3cc25","#f1a30c","#b854e6"]},a=new s(null,{onDone:function(t){alert("没有可消除的方块了，你的得分: ".concat(t)),a.initUI(l)}});a.initUI(l);
},{"fs":"7MKc","../utils":"LN/f"}]},{},["epB2"], null)